---
source: "blog"
title: "Tutorial: Auto-updating GeoServer layer configurations"
date: "2023-10-16T00:00:00"
link: "https://kartoza.com/blog/geoserver/auto-updating-geoserver-layer-configurations"
draft: "false"
showcase: "planet"
subscribers: ["kartoza"]
author: "Kartoza"
tags: ["geoserver"]
languages: ["en_gb"]
available_languages: ["en_gb"]
---

<div class="ql-editor read-mode"><p>Suppose you have a team digitising features in a desktop GIS like QGIS into a layer stored in PostgreSQL, that is also served through GeoServer. A frontend application accesses the WMS endpoint from GeoServer. Users accessing the frontend applications expect the layers to be live (i.e. to see instant changes as the vector layer is updated in QGIS).</p><p><br /></p><p>GeoServer reads the bounding box information from the data store during publishing and stores this information in the layer configuration dialog. As new features are added/deleted from the vector layer in PostgreSQL, GeoServer has no automatic way to reload its configuration to update the bounding box of the layer because it doesn't periodically poll the database for changes.</p><p><br /></p><p>GeoServer provides a RestAPI which we can use to automate this process. We can set up a cron job with a custom script to run at intervals to update the layer configuration. An even better approach would be to send signals to GeoServer when the layer changes in the database.</p><p><br /></p><p>We can achieve this by creating a&nbsp;Python function and running database triggers. This tutorial assumes you have already set up your PostgreSQL database and GeoServer. If you do not have one you can spin up these services by running the following:</p><p><br /></p><pre class="ql-code-block-container"><div class="ql-code-block">git clone git@github.com:kartoza/docker-geoserver.git</div><div class="ql-code-block">cd docker-geoserver</div><div class="ql-code-block">docker compose up -d</div></pre><p><br /></p><ol><li><span class="ql-ui" contenteditable="false"></span>Execute into the PostgreSQL docker container and install the following packages.</li></ol><pre class="ql-code-block-container"><div class="ql-code-block"> &nbsp;	apt update &amp;&amp; apt-get -y --no-install-recommends install python3-pip</div><div class="ql-code-block"> &nbsp; &nbsp;pip3 install requests --break-system-packages	</div></pre><ol><li><span class="ql-ui" contenteditable="false"></span>Login into the database through psql or exit the container and access the database through PGAdmin4 or DB Manager in QGIS.</li></ol><pre class="ql-code-block-container"><div class="ql-code-block">CREATE EXTENSION plpython3u;</div><div class="ql-code-block">CREATE OR REPLACE FUNCTION kartoza_publish_layer_to_geoserver(</div><div class="ql-code-block"> &nbsp; &nbsp;geo_site_url TEXT,</div><div class="ql-code-block"> &nbsp; &nbsp;store_name TEXT,</div><div class="ql-code-block"> &nbsp; &nbsp;geoserver_table_name TEXT</div><div class="ql-code-block">)</div><div class="ql-code-block">RETURNS TRIGGER AS $$</div><div class="ql-code-block">from requests.auth import HTTPBasicAuth</div><div class="ql-code-block">from requests import put</div><div class="ql-code-block">from os import environ</div><div class="ql-code-block"><br /></div><div class="ql-code-block"><br /></div><div class="ql-code-block">def recalculate_bbox(geo_site_url, store_name, geoserver_table_name):</div><div class="ql-code-block"> &nbsp; &nbsp;username = environ.get('GEOSERVER_ADMIN_USER','admin')</div><div class="ql-code-block"> &nbsp; &nbsp;user_pass = environ.get('GEOSERVER_ADMIN_PASSWORD', 'myawesomegeoserver')</div><div class="ql-code-block"> &nbsp; &nbsp;workspace_name = environ.get('DEFAULT_WORKSPACE', 'kartoza')</div><div class="ql-code-block"> &nbsp; &nbsp;auth = HTTPBasicAuth('%s' % username, '%s' % user_pass)</div><div class="ql-code-block"> &nbsp; &nbsp;headers = {"Content-type": "text/xml"}</div><div class="ql-code-block"> &nbsp; &nbsp;xml_data = "&lt;featureType&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/featureType&gt;"</div><div class="ql-code-block"> &nbsp; &nbsp;rest_url = '%s/rest/workspaces/%s/datastores/%s/featuretypes/%s?recalculate=nativebbox,latlonbbox' % (</div><div class="ql-code-block"> &nbsp; &nbsp; &nbsp; &nbsp;geo_site_url, workspace_name, store_name, geoserver_table_name)</div><div class="ql-code-block"> &nbsp; &nbsp;response = put(rest_url, headers=headers, data=xml_data, auth=auth)</div><div class="ql-code-block"> &nbsp; &nbsp;if response.status_code != 200:</div><div class="ql-code-block"> &nbsp; &nbsp; &nbsp; &nbsp;return response.raise_for_status</div><div class="ql-code-block"><br /></div><div class="ql-code-block"><br /></div><div class="ql-code-block"># Call the function</div><div class="ql-code-block">recalculate_bbox(geo_site_url, &nbsp;store_name, geoserver_table_name);</div><div class="ql-code-block">RETURN NEW;</div><div class="ql-code-block">$$ LANGUAGE plpython3u;</div><div class="ql-code-block"><br /></div><div class="ql-code-block">CREATE TRIGGER notify_poi_update</div><div class="ql-code-block"> &nbsp;BEFORE INSERT OR UPDATE OR DELETE &nbsp;ON public.poi</div><div class="ql-code-block"> &nbsp; &nbsp;FOR EACH STATEMENT EXECUTE PROCEDURE kartoza_publish_layer_to_geoserver('http://geoserver:8080/geoserver', &nbsp; 'digitization', 'poi');</div></pre><ol><li><span class="ql-ui" contenteditable="false"></span>Navigate to QGIS and digitise a few points from different locations. Save your changes.</li><li><span class="ql-ui" contenteditable="false"></span>Navigate to the layer definition in GeoServer and inspect the bounding box of the layer. As you make changes to the layer in QGIS, the layer bounding box changes in GeoServer.</li></ol><p>&nbsp;<img src="https://kartoza.com/files/tED3dBn.png" /></p><ol><li><span class="ql-ui" contenteditable="false"></span>Make a few changes and note the bounding box being updated and the layer also changing in the frontend application.</li></ol></div>
