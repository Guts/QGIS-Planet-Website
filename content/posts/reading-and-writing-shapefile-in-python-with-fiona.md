---
source: "blog"
title: "Reading and Writing Shapefiles in Python with Fiona"
date: "2024-06-10T00:00:00"
link: "https://kartoza.com/reading-and-writing-shapefile-in-python-with-fiona"
draft: "false"
showcase: "planet"
subscribers: ["kartoza"]
author: "Kartoza"
tags: []
languages: ["en_gb"]
available_languages: ["en_gb"]
---

<div class="ql-editor read-mode"><h2>What is Fiona?</h2><p><a href="https://github.com/Toblerity/Fiona" rel="noopener noreferrer">Fiona</a> is a FOSS Python library that can be used to read and write GIS formats like shape file and geopackage. We may stumble upon some use cases where we need to import or export GIS data from shapefiles and this is where Fiona comes to the rescue. Its usage is straightforward, making it simple to use.</p><p><br /></p><h2>Installing Fiona</h2><p>We can install Fiona easily using</p><pre class="ql-code-block-container"><div class="ql-code-block">pip install fiona</div></pre><h2>Reading Shapefiles</h2><p>Fiona has built in function to open shapefiles. First, import the necessary Fiona function.</p><pre class="ql-code-block-container"><div class="ql-code-block">import fiona</div><div class="ql-code-block">from fiona.model import to_dict</div></pre><p>Then, we open the shapefile using <strong>fiona.open()</strong>. We can wrap it in the Python context manager using <strong>with</strong>.</p><pre class="ql-code-block-container"><div class="ql-code-block">with fiona.open('path/to/shapefile.shp', 'r') as shapefile:</div><div class="ql-code-block"> &nbsp;...</div></pre><p>Inside the code block, we can do things like getting the CRS info.</p><pre class="ql-code-block-container"><div class="ql-code-block"> &nbsp;... &nbsp;</div><div class="ql-code-block"> &nbsp;print(shapefile.crs)</div></pre><p>Which in my case will show:</p><pre class="ql-code-block-container"><div class="ql-code-block">EPSG:4326</div></pre><p>When we open a shapefile using Fiona, it will be opened as a Fiona collection object. So when we do</p><pre class="ql-code-block-container"><div class="ql-code-block"> &nbsp;...</div><div class="ql-code-block"> &nbsp;print(shapefile)</div></pre><p>It will print:</p><pre class="ql-code-block-container"><div class="ql-code-block">&lt;open Collection 'path/to/shapefile.shp:shapefile', mode 'r' at 0x7fd460aa3df0&gt;</div></pre><p>We can convert it to a dictionary using <strong>to_dict</strong>.<strong> </strong></p><pre class="ql-code-block-container"><div class="ql-code-block"> &nbsp;...</div><div class="ql-code-block"> &nbsp;print(to_dict(shapefile))</div></pre><p>And it will be converted to dictionary.</p><pre class="ql-code-block-container"><div class="ql-code-block">{'geometry': {'coordinates': (60.0, 60.0), 'type': 'Point'}, 'id': '0', 'properties': {'count': 1, 'name': 'Point 1'}, 'type': 'Feature'}</div></pre><p><br /></p><p>The final code will look like this</p><pre class="ql-code-block-container"><div class="ql-code-block">import fiona</div><div class="ql-code-block">from fiona.model import to_dict</div><div class="ql-code-block"><br /></div><div class="ql-code-block">with fiona.open('export/my_shapefile.shp', 'r') as shapefile:</div><div class="ql-code-block"> &nbsp; &nbsp;print(to_dict(shapefile))</div><div class="ql-code-block"> &nbsp; &nbsp;for record in shapefile:</div><div class="ql-code-block"> &nbsp; &nbsp; &nbsp; &nbsp;# do something with the records</div><div class="ql-code-block"> &nbsp; &nbsp; &nbsp; &nbsp;...</div></pre><p><br /></p><h2>Writing Shapefiles</h2><p>When we want to create a shapefile using Fiona, first we need to import Fiona and <strong>from_epsg</strong>.</p><pre class="ql-code-block-container"><div class="ql-code-block">import fiona</div><div class="ql-code-block">from fiona.crs import from_epsg</div></pre><p><strong>from_epsg</strong> is a shortcut to the CRS mappings from EPSG codes. Then, we have to define the shapefile schema. In this example, a simple schema will be used</p><pre class="ql-code-block-container"><div class="ql-code-block">schema={</div><div class="ql-code-block">	'geometry': 'Point', </div><div class="ql-code-block">	'properties': {</div><div class="ql-code-block"> &nbsp;'count': 'int',</div><div class="ql-code-block"> &nbsp;'mean': 'float',</div><div class="ql-code-block"> &nbsp;'name': 'str:10', </div><div class="ql-code-block">	}</div><div class="ql-code-block">}</div></pre><p>That schema means these:</p><ol><li><span class="ql-ui" contenteditable="false"></span>Geometry type would be <strong>Point</strong></li><li><span class="ql-ui" contenteditable="false"></span>The feature would have 3 attributes:</li><li class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span><strong>count</strong>, with type <strong>int</strong>.</li><li class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span><strong>mean</strong>, with type <strong>float</strong>.</li><li class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span><strong>name</strong>, with type <strong>str </strong>and maximum length of 10.</li></ol><p>You can read the schema detail (like what field types available) in <a href="https://fiona.readthedocs.io/en/stable/manual.html#format-drivers-crs-bounds-and-schema." rel="noopener noreferrer">https://fiona.readthedocs.io/en/stable/manual.html#format-drivers-crs-bounds-and-schema.</a></p><p><br /></p><p>After defining the schema, open the destination file (could be existing or non-existing file). Here, we open a non-existing file in write mode using the context manager:</p><pre class="ql-code-block-container"><div class="ql-code-block">with fiona.open('path/to/shapefile.shp', 'w', crs=from_epsg(4326), driver='ESRI Shapefile', schema=schema) as output:</div></pre><p>We also specify these things when opening the file:</p><ol><li><span class="ql-ui" contenteditable="false"></span>Set the CRS to EPSG:4326 using <strong>from_epsg(4326) </strong>which will convert the EPSG integer code to the EPSG mapping.</li><li><span class="ql-ui" contenteditable="false"></span>Use 'Esri Shapefile' as the driver.</li><li><span class="ql-ui" contenteditable="false"></span>Set the schema to the one we defined previously.</li></ol><p>Inside the context manager, we can build the geometry and properties. The geometry needs to be in GeoJSON dictionary format, while properties is simply in dictionary format.</p><pre class="ql-code-block-container"><div class="ql-code-block">	...</div><div class="ql-code-block"> &nbsp; &nbsp;point = {'type': 'Point', 'coordinates': (60, 60)}</div><div class="ql-code-block">	prop = {</div><div class="ql-code-block"> &nbsp;'mean': 1.375,</div><div class="ql-code-block"> &nbsp;'name': "Point 1",</div><div class="ql-code-block"> &nbsp;'count': 1,</div><div class="ql-code-block">	}</div></pre><p>Finally, write the geometry and properties into the shapefile.</p><pre class="ql-code-block-container"><div class="ql-code-block"> &nbsp; &nbsp;...</div><div class="ql-code-block"> &nbsp; &nbsp;output.write({'geometry':point,'properties': prop})</div></pre><p>The full code should look like this</p><pre class="ql-code-block-container"><div class="ql-code-block">import fiona</div><div class="ql-code-block">from fiona.crs import from_epsg</div><div class="ql-code-block"><br /></div><div class="ql-code-block"><br /></div><div class="ql-code-block"># Shapefile schema</div><div class="ql-code-block">schema={</div><div class="ql-code-block">	'geometry': 'Point', </div><div class="ql-code-block">	'properties': {</div><div class="ql-code-block"> &nbsp;'count': 'int',</div><div class="ql-code-block"> &nbsp;'mean': 'float',</div><div class="ql-code-block"> &nbsp;'name': 'str:10', </div><div class="ql-code-block">	}</div><div class="ql-code-block">}</div><div class="ql-code-block">with fiona.open('path/to/shapefile.shp', 'w', crs=from_epsg(4326), driver='ESRI Shapefile', schema=schema) as output:</div><div class="ql-code-block">	point = {'type': 'Point', 'coordinates': (60, 60)}</div><div class="ql-code-block">	prop = {</div><div class="ql-code-block"> &nbsp;'mean': 1.375,</div><div class="ql-code-block"> &nbsp;'name': "Point 1",</div><div class="ql-code-block"> &nbsp;'count': 1,</div><div class="ql-code-block">	}</div><div class="ql-code-block">	output.write({'geometry':point,'properties': prop})</div></pre></div>
